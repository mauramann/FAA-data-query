---
title: "DSAN 6300: Mini-Project"
format:
  html:
    toc: true
    toc-location: right
    toc-title: "Table of Contents"
---

Welcome to the Exploratory Data Analysis of flights in the U.S. from June 2019! As you scroll down, you'll see the data has already been processed and is simply being visualized. Prior to the creation of the data visualization below, the data was queried using MySql and exported from MySql Workbench.

## Part 1: Data and Package Loading

```{r}
library(dplyr, quietly = TRUE)
library(ggplot2, quietly = TRUE)
library(plotly, quietly = TRUE)
rank_days <- read.csv('data/rank_days.csv')
max_early <- read.csv('data/max_early.csv')
max_delay <- read.csv('data/max_delay.csv')
max_avg_delay <- read.csv('data/max_avg_delay.csv')
flight_report <- read.csv('data/flight_report.csv')
cancelled_reason <- read.csv('data/cancelled_reason.csv')
cancelled_flights <- read.csv('data/cancelled_flights.csv')
airport_max_delay <- read.csv('data/airport_max_delay.csv')
```

## Part 2: Time Series - Number of Flights

```{r}
flight_report$FlightDate <- as.Date(flight_report$FlightDate)
my_time_series <- flight_report |> ggplot(aes(x=FlightDate, y=three_day_avg)) + 
geom_point(size = 1) + 
geom_area(alpha = 1/2, fill = 'lightblue') +
theme_minimal()+
labs(x = "Date", y = "Average Number of Flights (Past Three Days)", title = "Average Number of Flights over the Past Three Days in June, 2019") + 
theme(plot.title = element_text(size = 11, hjust = 0.5))
interactive_plot <- ggplotly(my_time_series)
interactive_plot
```

## Part 3: Multi-Numeric Variable Trend - Airlines

```{r}
combined_data <- inner_join(max_delay, max_early, by = "name")
combined_data$Max_Early <- abs(combined_data$Max_Early)

my_scatterplot <- combined_data |> ggplot(aes(x=Max_Early, y=Max_Delay, color = name)) +
geom_point(shape = 18) +
theme_minimal()+
labs(x = "Maximum Early Departure (Min)", y = "Maximum Flight Delay (Min)", color = "Airline", title = "Airline Maximum Early Departure vs Delay") + 
theme(plot.title = element_text(size = 11, hjust = 0.5), legend.position = "none")
interactive_scatter <- ggplotly(my_scatterplot)
interactive_scatter
```

### Pearson Correlation Coefficient
```{r}
p <- cor(combined_data$Max_Early, combined_data$Max_Delay)
print(p)
```

## Part 4: Deep Dive - Airports

```{r}
max_avg_delay$Origin <- factor(max_avg_delay$Origin, levels = max_avg_delay$Origin)
max_avg_delay <- max_avg_delay |> arrange(Avg_Delay)

top50 <- head(max_avg_delay, 50)

top50 |> ggplot(aes(x=Origin, y=Avg_Delay)) +
  geom_segment(aes(x=Origin, xend=Origin, y=0, yend=Avg_Delay)) +
  geom_point() +
  theme_minimal() +
  coord_flip() +
  xlab("") +
  ylab("Average Delay (Min)") +
  ggtitle("Top 50 Airports with the Greatest Average Delays")
```